<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Section-wise Answer Key Checker</title>
<style>
body { font-family: Arial, sans-serif; background:#f5f6fa; padding:20px; }
h1 { text-align:center; margin-bottom:20px; color:#2f3640; }
#inputArea { text-align:center; margin-bottom:20px; }
#inputArea input { width:60%; padding:10px; font-size:1em; margin-right:10px; }
button { padding:10px 20px; font-size:1em; cursor:pointer; border:none; border-radius:5px; background:#44bd32; color:white; transition:0.3s; }
button:hover { background:#4cd137; }
#iframeContainer { text-align:center; margin:20px auto; max-width:1000px; }
#testFrame { width:100%; height:400px; border:2px solid #dcdde1; border-radius:10px; }
#scoreBoard { margin-top:20px; padding:20px; background:#fff; border-radius:10px; box-shadow:0 0 15px #dcdde1; max-width:900px; margin:auto; font-size:1.1em; }
.section { margin-bottom:8px; font-weight:bold; }
#downloadBtn { background:#0097e6; margin-top:15px; }
#downloadBtn:hover { background:#00a8ff; }
</style>
</head>
<body>

<h1>Section-wise Answer Key Checker</h1>

<div id="inputArea">
    <input type="text" id="urlInput" placeholder="Paste test page URL here">
    <button onclick="loadTest()">Load Test</button>
</div>

<div id="iframeContainer">
    <iframe id="testFrame"></iframe>
</div>

<div style="text-align:center; margin-top:10px;">
    <button onclick="checkScore()">Check Score</button>
</div>

<div id="scoreBoard" style="display:none;"></div>
<div style="text-align:center;">
    <button id="downloadBtn" onclick="downloadScore()" style="display:none;">Download Score as HTML</button>
</div>

<script>
// ====== Example answer key ======
const answerKey = {
    "Math": { start: 0, count: 20, answers: ["A","B","C","D","A","B","C","D","A","B","C","D","A","B","C","D","A","B","C","D"] },
    "Science": { start: 20, count: 20, answers: ["D","C","B","A","D","C","B","A","D","C","B","A","D","C","B","A","D","C","B","A"] }
};

// ====== Load test in iframe ======
function loadTest() {
    const url = document.getElementById("urlInput").value.trim();
    if(url) {
        document.getElementById("testFrame").src = url;
    }
}

// ====== Check section-wise score ======
function checkScore() {
    const iframe = document.getElementById("testFrame");
    const iframeDoc = iframe.contentDocument || iframe.contentWindow.document;
    const questions = iframeDoc.getElementsByClassName("question-pnl");
    if(!questions || questions.length === 0) { alert("No questions found in iframe!"); return; }

    let totalScore = 0;
    let outputHTML = "";

    for(const sectionName in answerKey){
        const section = answerKey[sectionName];
        let sectionMarks = 0;
        for(let i=section.start; i<section.start + section.count; i++){
            const userAnsElem = questions[i]?.getElementsByClassName("bold")[5]; // adjust index if needed
            const userAns = userAnsElem?.textContent.trim();
            if(userAns === section.answers[i - section.start]){
                sectionMarks++;
            }
        }
        totalScore += sectionMarks;
        outputHTML += `<div class="section">${sectionName}: ${sectionMarks}/${section.count}</div>`;
    }

    outputHTML += `<div class="section" style="font-size:1.2em; margin-top:10px;">Total: ${totalScore}</div>`;
    const scoreBoard = document.getElementById("scoreBoard");
    scoreBoard.innerHTML = outputHTML;
    scoreBoard.style.display = "block";
    document.getElementById("downloadBtn").style.display = "inline-block";
}

// ====== Download score as HTML ======
function downloadScore() {
    const content = document.getElementById("scoreBoard").innerHTML;
    const blob = new Blob([`<html><body>${content}</body></html>`], {type:"text/html"});
    const url = URL.createObjectURL(blob);
    const a = document.createElement("a");
    a.href = url;
    a.download = "score.html";
    a.click();
    URL.revokeObjectURL(url);
}
</script>

</body>
</html>
