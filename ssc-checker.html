<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Fancier Answer Key Checker</title>
<style>
body { font-family: Arial, sans-serif; background:#f0f2f5; padding:20px; }
h1 { text-align:center; }
#inputArea { margin-bottom:20px; text-align:center; }
#inputArea input { width:60%; padding:10px; font-size:1em; margin-right:10px; }
#questionsContainer { background:#fff; padding:20px; border-radius:10px; box-shadow:0 0 10px #ccc; max-width:800px; margin:auto; }
.question-pnl { margin-bottom:15px; }
.question-pnl input { width:60px; padding:5px; font-size:1em; margin-left:10px; }
button { padding:10px 20px; font-size:1em; cursor:pointer; }
#scoreBoard { margin-top:20px; padding:15px; background:#fff; border-radius:10px; box-shadow:0 0 10px #ccc; max-width:800px; margin:auto; }
.section { margin-bottom:5px; }
</style>
</head>
<body>

<h1>Fancier Answer Key Checker</h1>

<div id="inputArea">
    <input type="text" id="urlInput" placeholder="Paste test page URL here">
    <button id="loadBtn">Load Questions</button>
</div>

<div id="questionsContainer"></div>

<div style="text-align:center; margin-top:15px;">
    <button id="checkScoreBtn">Check Score</button>
</div>

<div id="scoreBoard"></div>

<script>
// Load questions from a test URL
document.getElementById("loadBtn").addEventListener("click", async function() {
    const url = document.getElementById("urlInput").value.trim();
    if(!url) return alert("Enter a valid URL");

    try {
        const res = await fetch(url);
        const text = await res.text();
        const parser = new DOMParser();
        const doc = parser.parseFromString(text, "text/html");

        const questionPanels = doc.querySelectorAll(".question-pnl");
        const container = document.getElementById("questionsContainer");
        container.innerHTML = "";

        questionPanels.forEach((q, i) => {
            const section = q.dataset.section || "General";
            // For your key checker, assume correct answer is in .bold:nth-child(6)
            const correctAnswerElem = q.querySelector(".bold:nth-child(6)");
            const correctAnswer = correctAnswerElem ? correctAnswerElem.textContent.trim() : "";
            
            const div = document.createElement("div");
            div.className = "question-pnl";
            div.dataset.section = section;
            div.innerHTML = `Q${i+1} (${section}): <input type="text" class="answer" data-correct="${correctAnswer}">`;
            container.appendChild(div);
        });
    } catch(e) {
        alert("Failed to load questions. Make sure the URL allows fetching.");
        console.error(e);
    }
});

// Compute total and section-wise score
document.getElementById("checkScoreBtn").addEventListener("click", function() {
    const allQuestions = document.querySelectorAll(".question-pnl");
    let totalMarks = 0;
    let sectionMarks = {};

    allQuestions.forEach(q => {
        const userAnswer = q.querySelector(".answer").value.trim().toUpperCase();
        const correctAnswer = q.querySelector(".answer").dataset.correct;
        const section = q.dataset.section || "General";

        if(userAnswer === correctAnswer) totalMarks++;
        sectionMarks[section] = sectionMarks[section] || 0;
        if(userAnswer === correctAnswer) sectionMarks[section]++;
    });

    let resultHTML = `<h2>Total Score: ${totalMarks} / ${allQuestions.length}</h2>`;
    resultHTML += `<h3>Section-wise Scores:</h3>`;
    for(const sec in sectionMarks) {
        const totalInSection = Array.from(allQuestions).filter(q => q.dataset.section === sec).length;
        resultHTML += `<div class="section">${sec}: ${sectionMarks[sec]} / ${totalInSection}</div>`;
    }

    document.getElementById("scoreBoard").innerHTML = resultHTML;
});
</script>

</body>
</html>
